# 收據圖片記帳使用指南

本文件說明如何使用 LINE Bot 的圖片識別功能進行記帳。

## 🎯 功能說明

v1.5.0 支援直接上傳收據圖片進行記帳，系統會自動識別：
- ✅ 品項名稱
- ✅ 金額
- ✅ 付款方式（如果收據上有標註）
- ✅ 日期（如果收據上有標註）

## 📝 使用方式

### 方式 1：直接上傳收據（推薦）

**適用情況**：收據上有明確標示付款方式

```
使用者：[上傳收據圖片]

系統回覆：
✅ 收據識別成功！已記錄 2 個項目：

📋 #1 美式咖啡
💰 50 元 | 信用卡
📂 家庭／飲品

📋 #2 三明治
💰 80 元 | 信用卡
📂 家庭／餐飲／早餐

🔖 交易ID：20251115-143052
💳 付款方式：信用卡（共用）
📅 日期：2025-11-15
```

### 方式 2：收據無付款方式標註

**系統行為**：自動預設為「現金」並提醒

```
使用者：[上傳收據圖片]

系統回覆：
✅ 收據識別成功！已記錄 2 個項目：

📋 #1 咖啡
💰 50 元 | 現金
📂 家庭／飲品

📋 #2 蛋糕
💰 120 元 | 現金
📂 家庭／點心

🔖 交易ID：20251115-143158
💳 付款方式：現金（共用）
📅 日期：2025-11-15

⚠️ 未從收據識別到付款方式，已預設為「現金」
💡 如不正確，請用文字補充記帳
範例：「剛買的咖啡用Line轉帳，50元」
```

**補充記帳**：

如果付款方式不對，再發送一條文字訊息重新記帳：

```
使用者：咖啡50元，蛋糕120元，用Line轉帳

系統回覆：
✅ 記帳成功！已記錄 2 個項目：
...
💳 付款方式：Line 轉帳（共用）
```

## 💡 最佳實踐

### 建議 1：拍攝清晰的收據

- ✅ 光線充足
- ✅ 對焦清晰
- ✅ 收據平整
- ✅ 包含完整資訊（品項、金額）

### 建議 2：了解預設行為

- 如果收據沒有付款方式 → 預設「現金」
- 如果需要修正 → 用文字補充記帳

### 建議 3：養成記錄習慣

**習慣 A**：隨拍隨傳
```
1. 拿到收據 → 立即拍照上傳
2. 系統自動識別
3. 檢查付款方式是否正確
4. 如不對 → 補發文字訊息
```

**習慣 B**：定期整理
```
1. 收集一天的收據
2. 晚上集中上傳
3. 逐一檢查並補充資訊
```

## 🔍 識別失敗的處理

### 情況 1：非收據圖片

```
系統回覆：
❌ 無法辨識收據資訊

這不是收據圖片

💡 請提供文字描述進行記帳，格式如：
「午餐花了150元，用現金」
```

**處理方式**：改用文字描述記帳

### 情況 2：圖片模糊

```
系統回覆：
❌ 收據圖片不清晰

圖片模糊，無法辨識品項和金額

💡 請提供文字描述，格式如：
「品項、金額、付款方式」
範例：「午餐花了150元，用現金」
```

**處理方式**：
- 重新拍攝更清晰的照片，或
- 用文字描述記帳

### 情況 3：非台幣收據

```
系統回覆：
❌ 不支援的幣別

收據幣別為 JPY，v1.5.0 僅支援台幣

💡 請提供文字描述並手動換算台幣金額，格式如：
「午餐花了150元，用現金」
```

**處理方式**：手動換算成台幣後用文字記帳

### 情況 4：資訊不完整

```
系統回覆：
❌ 收據資訊不完整

無法辨識品項或金額

💡 請提供文字描述補充完整資訊，格式如：
「品項、金額、付款方式」
```

**處理方式**：用文字補充完整資訊

## ⚠️ 注意事項

### LINE 限制

1. **圖文無法混合**
   - ❌ 不能在同一條訊息中同時發送圖片和文字
   - ✅ 需要分開發送（先圖後文，或先文後圖）

2. **無狀態架構**
   - 每條訊息獨立處理
   - 無法關聯「上一條」或「剛才」的訊息
   - 補充資訊時需要重新提供完整內容

### 付款方式預設規則

系統會按以下順序決定付款方式：

1. **優先**：從收據圖片識別（如果有標註）
2. **預設**：如果無法識別 → 預設為「現金」
3. **補充**：使用者可用文字重新記帳

### 成本考量

- 每次圖片分析約 **$0.006 USD**
- 建議先測試幾張確認效果
- 如果識別率不佳，改用文字記帳更經濟

## 📊 使用場景範例

### 場景 1：便利商店購物

```
1. 在 7-11 購買咖啡和三明治
2. 拿到收據（通常有付款方式標註）
3. 拍照上傳到 LINE Bot
4. 系統自動識別 → 完成記帳
```

### 場景 2：餐廳用餐

```
1. 餐廳結帳拿到收據（通常沒有付款方式）
2. 拍照上傳
3. 系統識別 → 預設為「現金」
4. 補發：「午餐花了350元，用FlyGo信用卡」
```

### 場景 3：咖啡店

```
1. 星巴克購買飲料（收據可能無付款方式）
2. 拍照上傳
3. 系統識別 → 預設為「現金」
4. 如果用信用卡 → 補發：「咖啡150元，用星展永續卡」
```

## 🚀 進階技巧

### 技巧 1：批次處理收據

如果有多張收據：

```
1. 逐一上傳每張收據
2. 系統分別識別並記帳
3. 每張收據獲得獨立的交易ID
4. 最後統一檢查並補充付款方式
```

### 技巧 2：混合使用圖片和文字

對於複雜的消費：

```
1. 簡單收據 → 直接上傳圖片
2. 複雜消費 → 用文字詳細描述
3. 例如：「星巴克咖啡150元，路易莎咖啡120元，都用狗卡」
```

### 技巧 3：建立個人習慣

- 固定時間整理收據（如每晚睡前）
- 養成拍攝清晰照片的習慣
- 了解常用店家的收據格式

## ❓ 常見問題

**Q1: 為什麼系統預設付款方式為現金？**
A: 因為大多數收據不會標註付款方式，而現金是最常見的付款方式。如果不正確，可以用文字補充記帳。

**Q2: 可以先說付款方式再上傳圖片嗎？**
A: 目前不支援。v1.5.0 採用無狀態架構，每條訊息獨立處理。建議先上傳圖片，如果付款方式不對再補充。

**Q3: 如果收據有多個項目，付款方式會是什麼？**
A: 所有項目共用同一個付款方式（從收據識別或預設為現金）。這符合實際情況：一次購物通常只用一種付款方式。

**Q4: 可以上傳外幣收據嗎？**
A: v1.5.0 僅支援台幣（TWD）收據。如果是外幣，請手動換算後用文字記帳。

**Q5: 圖片識別不準確怎麼辦？**
A:
1. 重新拍攝更清晰的照片
2. 改用文字描述記帳
3. 提供回饋給開發者改進識別 prompt

**Q6: 系統會儲存我的收據圖片嗎？**
A: 不會。圖片僅用於即時識別，處理完畢後不會儲存。

## 📞 技術支援

如遇到問題：
1. 檢查圖片是否清晰
2. 確認收據為台幣
3. 嘗試用文字重新記帳
4. 查看錯誤訊息提示

---

**版本**: v1.5.0
**最後更新**: 2025-11-15
