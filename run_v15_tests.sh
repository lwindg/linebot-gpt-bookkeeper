#!/bin/bash
# v1.5.0 æ¸¬è©¦è…³æœ¬ - æ”¯æ´è‡ªå‹•åˆ¤æ–·å’Œäººå·¥æª¢è¦–
#
# ä½¿ç”¨æ–¹å¼ï¼š
#   ./run_v15_tests.sh          # äººå·¥åˆ¤æ–·æ¨¡å¼ï¼ˆé è¨­ï¼‰
#   ./run_v15_tests.sh --auto   # è‡ªå‹•åˆ¤æ–·æ¨¡å¼
#   ./run_v15_tests.sh --help   # é¡¯ç¤ºèªªæ˜

# é¡è‰²å®šç¾©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# å…¨åŸŸè®Šæ•¸
AUTO_MODE=false
TOTAL_TESTS=0
PASSED_TESTS=0
FAILED_TESTS=0
SKIPPED_TESTS=0

# è§£æåƒæ•¸
if [[ "$1" == "--auto" ]]; then
    AUTO_MODE=true
elif [[ "$1" == "--help" || "$1" == "-h" ]]; then
    echo "v1.5.0 å¤šé …ç›®æ”¯å‡ºæ¸¬è©¦è…³æœ¬"
    echo ""
    echo "ä½¿ç”¨æ–¹å¼ï¼š"
    echo "  ./run_v15_tests.sh          äººå·¥åˆ¤æ–·æ¨¡å¼ï¼ˆé è¨­ï¼‰"
    echo "  ./run_v15_tests.sh --auto   è‡ªå‹•åˆ¤æ–·æ¨¡å¼"
    echo "  ./run_v15_tests.sh --help   é¡¯ç¤ºæ­¤èªªæ˜"
    echo ""
    echo "è‡ªå‹•åˆ¤æ–·æ¨¡å¼ï¼š"
    echo "  - è‡ªå‹•æ¯”å°å¯¦éš›çµæœèˆ‡é æœŸçµæœ"
    echo "  - é¡¯ç¤ºè©³ç´°çš„å·®ç•°è³‡è¨Š"
    echo "  - çµ±è¨ˆé€šé/å¤±æ•—æ¸¬è©¦æ•¸é‡"
    echo "  - åˆ¤æ–·é …ç›®ï¼šæ„åœ–ã€é …ç›®æ•¸é‡ã€ä»˜æ¬¾æ–¹å¼ã€éŒ¯èª¤è¨Šæ¯"
    echo "  - ä¸åˆ¤æ–·ï¼šäº¤æ˜“IDï¼ˆæ¯æ¬¡éƒ½ä¸åŒï¼‰"
    echo ""
    exit 0
fi

echo "======================================================================"
echo "ğŸ§ª v1.5.0 å¤šé …ç›®æ”¯å‡ºæ¸¬è©¦è…³æœ¬"
echo "======================================================================"
echo ""
if [[ "$AUTO_MODE" == true ]]; then
    echo "æ¨¡å¼ï¼šğŸ¤– è‡ªå‹•åˆ¤æ–·"
else
    echo "æ¨¡å¼ï¼šğŸ‘¤ äººå·¥åˆ¤æ–·"
    echo ""
    echo "ä½¿ç”¨æ–¹å¼ï¼š"
    echo "  - æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹æœƒé¡¯ç¤ºæ¸¬è©¦è¨Šæ¯å’Œçµæœ"
    echo "  - æŒ‰ Enter ç¹¼çºŒä¸‹ä¸€å€‹æ¸¬è©¦"
    echo "  - æŒ‰ Ctrl+C ä¸­æ–·æ¸¬è©¦"
fi
echo ""
read -p "æŒ‰ Enter é–‹å§‹æ¸¬è©¦..."

# æå–æ¬„ä½å€¼çš„è¼”åŠ©å‡½æ•¸
extract_field() {
    local output="$1"
    local field="$2"

    case "$field" in
        "intent")
            # æå–æ„åœ–ï¼ˆå¯èƒ½æ˜¯ã€Œè¨˜å¸³ã€ã€ã€Œå°è©±ã€ã€ã€ŒéŒ¯èª¤ã€ï¼‰
            echo "$output" | grep "ğŸ“ æ„åœ–:" | sed 's/.*ğŸ“ æ„åœ–: //' | xargs
            ;;
        "item_count")
            # æå–é …ç›®æ•¸é‡
            echo "$output" | grep "é …ç›®æ•¸é‡:" | sed 's/.*é …ç›®æ•¸é‡: //' | xargs
            ;;
        "payment")
            # æå–å…±ç”¨ä»˜æ¬¾æ–¹å¼ï¼ˆå¤šé …ç›®æ ¼å¼ï¼‰
            echo "$output" | grep "ğŸ’³ å…±ç”¨ä»˜æ¬¾æ–¹å¼:" | sed 's/.*ğŸ’³ å…±ç”¨ä»˜æ¬¾æ–¹å¼: //' | xargs
            ;;
        "payment_single")
            # æå–ä»˜æ¬¾æ–¹å¼ï¼ˆå–®é …ç›®æ ¼å¼ï¼‰
            echo "$output" | grep "ğŸ’³ ä»˜æ¬¾:" | sed 's/.*ğŸ’³ ä»˜æ¬¾: //' | xargs
            ;;
        "error_message")
            # æå–éŒ¯èª¤è¨Šæ¯
            echo "$output" | grep "ğŸ’¬ éŒ¯èª¤è¨Šæ¯:" | sed 's/.*ğŸ’¬ éŒ¯èª¤è¨Šæ¯: //' | xargs
            ;;
        "response")
            # æå–å°è©±å›æ‡‰
            echo "$output" | grep "ğŸ’¬ å›æ‡‰:" | sed 's/.*ğŸ’¬ å›æ‡‰: //' | xargs
            ;;
        "transaction_id")
            # æå–äº¤æ˜“IDï¼ˆå–®é …ç›®æ ¼å¼ï¼‰
            echo "$output" | grep "ğŸ†” äº¤æ˜“ID:" | sed 's/.*ğŸ†” äº¤æ˜“ID: //' | xargs
            ;;
        "shared_transaction_id")
            # æå–å…±ç”¨äº¤æ˜“IDï¼ˆå¤šé …ç›®æ ¼å¼ï¼‰
            echo "$output" | grep "ğŸ†” å…±ç”¨äº¤æ˜“ID:" | sed 's/.*ğŸ†” å…±ç”¨äº¤æ˜“ID: //' | xargs
            ;;
    esac
}

# æ¯”è¼ƒçµæœ
compare_result() {
    local actual="$1"
    local expected="$2"
    local field_name="$3"

    # å¦‚æœé æœŸå€¼ç‚ºç©ºï¼Œè·³éæª¢æŸ¥
    if [[ -z "$expected" ]]; then
        return 0
    fi

    # æ•¸å­—æ¯”è¼ƒï¼ˆé …ç›®æ•¸é‡ï¼‰
    if [[ "$field_name" == "é …ç›®æ•¸é‡" ]]; then
        if [[ "$actual" == "$expected" ]]; then
            return 0
        else
            return 1
        fi
    fi

    # åŒ…å«æ¯”è¼ƒï¼ˆç”¨æ–¼éŒ¯èª¤è¨Šæ¯ï¼‰
    if [[ "$field_name" == "éŒ¯èª¤è¨Šæ¯" ]]; then
        if [[ "$actual" == *"$expected"* ]]; then
            return 0
        else
            return 1
        fi
    fi

    # ä¸€èˆ¬å­—ä¸²æ¯”è¼ƒ
    if [[ "$actual" == "$expected" ]]; then
        return 0
    else
        return 1
    fi
}

# æ¸¬è©¦å‡½æ•¸ï¼ˆäººå·¥åˆ¤æ–·æ¨¡å¼ï¼‰
run_test_manual() {
    local category="$1"
    local description="$2"
    local message="$3"
    local expected="$4"

    echo ""
    echo "======================================================================"
    echo "[$category] $description"
    echo "======================================================================"
    if [[ -n "$expected" ]]; then
        echo "é æœŸçµæœï¼š$expected"
    fi
    echo ""

    python test_local.py "$message"

    echo ""
    read -p "æŒ‰ Enter ç¹¼çºŒä¸‹ä¸€å€‹æ¸¬è©¦..."
}

# æ¸¬è©¦å‡½æ•¸ï¼ˆè‡ªå‹•åˆ¤æ–·æ¨¡å¼ï¼‰
run_test_auto() {
    local category="$1"
    local description="$2"
    local message="$3"
    local expected_desc="$4"
    local expected_intent="$5"
    local expected_item_count="$6"
    local expected_payment="$7"
    local expected_error_keyword="$8"

    ((TOTAL_TESTS++))

    echo ""
    echo -e "${BLUE}======================================================================"
    echo "[$category] $description"
    echo -e "======================================================================${NC}"
    echo "ğŸ“¨ æ¸¬è©¦è¨Šæ¯: $message"
    if [[ -n "$expected_desc" ]]; then
        echo "ğŸ“‹ é æœŸ: $expected_desc"
    fi

    # åŸ·è¡Œæ¸¬è©¦ä¸¦æ•ç²è¼¸å‡º
    output=$(python test_local.py "$message" 2>&1)

    # æå–å¯¦éš›çµæœ
    actual_intent=$(extract_field "$output" "intent")
    actual_item_count=$(extract_field "$output" "item_count")
    actual_payment=$(extract_field "$output" "payment")
    actual_payment_single=$(extract_field "$output" "payment_single")
    actual_error=$(extract_field "$output" "error_message")
    actual_transaction_id=$(extract_field "$output" "transaction_id")
    actual_shared_transaction_id=$(extract_field "$output" "shared_transaction_id")

    # çµ±ä¸€ä»˜æ¬¾æ–¹å¼ï¼ˆå„ªå…ˆä½¿ç”¨å¤šé …ç›®æ ¼å¼ï¼Œå¦å‰‡ä½¿ç”¨å–®é …ç›®æ ¼å¼ï¼‰
    if [[ -z "$actual_payment" ]]; then
        actual_payment="$actual_payment_single"
    fi

    # çµ±ä¸€äº¤æ˜“IDï¼ˆå„ªå…ˆä½¿ç”¨å…±ç”¨äº¤æ˜“IDï¼Œå¦å‰‡ä½¿ç”¨å–®é …ç›®äº¤æ˜“IDï¼‰
    if [[ -z "$actual_transaction_id" ]]; then
        actual_transaction_id="$actual_shared_transaction_id"
    fi

    # åˆ¤æ–·æ¸¬è©¦çµæœ
    test_passed=true
    failures=()

    # æª¢æŸ¥æ„åœ–
    if ! compare_result "$actual_intent" "$expected_intent" "æ„åœ–"; then
        test_passed=false
        failures+=("æ„åœ–: é æœŸ[$expected_intent] å¯¦éš›[$actual_intent]")
    fi

    # æª¢æŸ¥é …ç›®æ•¸é‡ï¼ˆåªåœ¨å¤šé …ç›®è¨˜å¸³æ™‚ï¼‰
    if [[ -n "$expected_item_count" ]]; then
        if ! compare_result "$actual_item_count" "$expected_item_count" "é …ç›®æ•¸é‡"; then
            test_passed=false
            failures+=("é …ç›®æ•¸é‡: é æœŸ[$expected_item_count] å¯¦éš›[$actual_item_count]")
        fi
    fi

    # æª¢æŸ¥ä»˜æ¬¾æ–¹å¼
    if [[ -n "$expected_payment" ]]; then
        if ! compare_result "$actual_payment" "$expected_payment" "ä»˜æ¬¾æ–¹å¼"; then
            test_passed=false
            failures+=("ä»˜æ¬¾æ–¹å¼: é æœŸ[$expected_payment] å¯¦éš›[$actual_payment]")
        fi
    fi

    # æª¢æŸ¥éŒ¯èª¤è¨Šæ¯ï¼ˆåªåœ¨éŒ¯èª¤æ„åœ–æ™‚ï¼‰
    if [[ "$expected_intent" == "éŒ¯èª¤" ]] && [[ -n "$expected_error_keyword" ]]; then
        if ! compare_result "$actual_error" "$expected_error_keyword" "éŒ¯èª¤è¨Šæ¯"; then
            test_passed=false
            failures+=("éŒ¯èª¤è¨Šæ¯: é æœŸåŒ…å«[$expected_error_keyword] å¯¦éš›[$actual_error]")
        fi
    fi

    # é¡¯ç¤ºçµæœ
    if [[ "$test_passed" == true ]]; then
        echo -e "${GREEN}âœ… æ¸¬è©¦é€šé${NC}"
        ((PASSED_TESTS++))
    else
        echo -e "${RED}âŒ æ¸¬è©¦å¤±æ•—${NC}"
        echo -e "${YELLOW}å·®ç•°é …ç›®ï¼š${NC}"
        for failure in "${failures[@]}"; do
            echo -e "  ${RED}âœ—${NC} $failure"
        done
        ((FAILED_TESTS++))
    fi

    # é¡¯ç¤ºå¯¦éš›çµæœæ‘˜è¦
    echo ""
    echo "ğŸ“Š å¯¦éš›çµæœï¼š"
    echo "  æ„åœ–: $actual_intent"
    if [[ -n "$actual_item_count" ]]; then
        echo "  é …ç›®æ•¸: $actual_item_count"
    fi
    if [[ -n "$actual_payment" ]]; then
        echo "  ä»˜æ¬¾æ–¹å¼: $actual_payment"
    fi
    if [[ "$actual_intent" == "éŒ¯èª¤" ]] && [[ -n "$actual_error" ]]; then
        echo "  éŒ¯èª¤è¨Šæ¯: $actual_error"
    fi
    if [[ "$actual_intent" == "è¨˜å¸³" ]] && [[ -n "$actual_transaction_id" ]]; then
        echo "  äº¤æ˜“ID: $actual_transaction_id ï¼ˆåƒ…ä¾›åƒè€ƒï¼Œä¸æ¯”å°ï¼‰"
    fi

    echo ""

    # è‡ªå‹•æ¨¡å¼ä¸‹çŸ­æš«åœé “è®“ä½¿ç”¨è€…çœ‹æ¸…çµæœ
    sleep 0.3
}

# é¸æ“‡æ¸¬è©¦å‡½æ•¸
run_test() {
    if [[ "$AUTO_MODE" == true ]]; then
        run_test_auto "$@"
    else
        run_test_manual "$1" "$2" "$3" "$4"
    fi
}

# ============================================================
# å–®é …ç›®è¨˜å¸³ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
# ============================================================

run_test "å‘å¾Œç›¸å®¹" "TC-V15-001: v1 æ ¼å¼å…¼å®¹ - æ¨™æº–è¨˜å¸³" \
    "åˆé¤120å…ƒç¾é‡‘" \
    "âœ… å–®é …ç›®ï¼Œä½¿ç”¨ v1 æ ¼å¼é¡¯ç¤º" \
    "è¨˜å¸³" "" "ç¾é‡‘" ""

run_test "å‘å¾Œç›¸å®¹" "TC-V15-002: v1 æ ¼å¼å…¼å®¹ - å«æš±ç¨±" \
    "é»å¿ƒ200å…ƒç‹—å¡" \
    "âœ… ä»˜æ¬¾æ–¹å¼ï¼šå°æ–°ç‹—å¡" \
    "è¨˜å¸³" "" "å°æ–°ç‹—å¡" ""

run_test "å‘å¾Œç›¸å®¹" "TC-V15-003: v1 æ ¼å¼å…¼å®¹ - è‡ªç„¶èªå¥" \
    "è²·äº†å’–å•¡50å…ƒï¼ŒLineè½‰å¸³" \
    "âœ… å–®é …ç›®ï¼Œv1 æ ¼å¼" \
    "è¨˜å¸³" "" "Line è½‰å¸³" ""

# ============================================================
# å¤šé …ç›®è¨˜å¸³ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
# ============================================================

run_test "å¤šé …ç›®" "TC-V15-010: é›™é …ç›® - é€—è™Ÿåˆ†éš”" \
    "æ—©é¤80å…ƒï¼Œåˆé¤150å…ƒï¼Œç¾é‡‘" \
    "âœ… 2å€‹é …ç›®ï¼Œå…±ç”¨ä»˜æ¬¾æ–¹å¼ï¼šç¾é‡‘" \
    "è¨˜å¸³" "2" "ç¾é‡‘" ""

run_test "å¤šé …ç›®" "TC-V15-011: é›™é …ç›® - ä»˜æ¬¾æ–¹å¼åœ¨å‰" \
    "ç”¨ç‹—å¡ï¼Œå’–å•¡50ï¼Œä¸‰æ˜æ²»35" \
    "âœ… 2å€‹é …ç›®ï¼Œå…±ç”¨ä»˜æ¬¾æ–¹å¼ï¼šå°æ–°ç‹—å¡" \
    "è¨˜å¸³" "2" "å°æ–°ç‹—å¡" ""

run_test "å¤šé …ç›®" "TC-V15-012: ä¸‰é …ç›® - æ—©åˆæ™šé¤" \
    "æ—©é¤50å…ƒï¼Œåˆé¤120å…ƒï¼Œæ™šé¤200å…ƒï¼Œç¾é‡‘" \
    "âœ… 3å€‹é …ç›®ï¼Œå…±ç”¨ä»˜æ¬¾æ–¹å¼ï¼šç¾é‡‘" \
    "è¨˜å¸³" "3" "ç¾é‡‘" ""

run_test "å¤šé …ç›®" "TC-V15-013: é›™é …ç›® - åˆ†è™Ÿåˆ†éš”" \
    "å’–å•¡45å…ƒï¼›è›‹ç³•120å…ƒï¼›Lineè½‰å¸³" \
    "âœ… 2å€‹é …ç›®ï¼Œåˆ†è™Ÿåˆ†éš”" \
    "è¨˜å¸³" "2" "Line è½‰å¸³" ""

run_test "å¤šé …ç›®" "TC-V15-014: é›™é …ç›® - é “è™Ÿåˆ†éš”" \
    "æ—©é¤ä¸‰æ˜æ²»35ã€é£²æ–™30ã€ç¾é‡‘" \
    "âœ… 2å€‹é …ç›®ï¼Œé “è™Ÿåˆ†éš”" \
    "è¨˜å¸³" "2" "ç¾é‡‘" ""

run_test "å¤šé …ç›®" "TC-V15-015: å››é …ç›®ä»¥ä¸Š" \
    "å’–å•¡50ã€ä¸‰æ˜æ²»35ã€æ²™æ‹‰80ã€æœæ±40ã€ç¾é‡‘" \
    "âœ… 4å€‹é …ç›®ï¼Œå…±ç”¨ä»˜æ¬¾æ–¹å¼" \
    "è¨˜å¸³" "4" "ç¾é‡‘" ""

# ============================================================
# å…±ç”¨ä»˜æ¬¾æ–¹å¼é©—è­‰
# ============================================================

run_test "å…±ç”¨é©—è­‰" "TC-V15-020: å…±ç”¨äº¤æ˜“IDé©—è­‰" \
    "æ—©é¤80å…ƒï¼Œåˆé¤150å…ƒï¼Œç¾é‡‘" \
    "âœ… æª¢æŸ¥å…©å€‹é …ç›®çš„äº¤æ˜“IDæ˜¯å¦ç›¸åŒ" \
    "è¨˜å¸³" "2" "ç¾é‡‘" ""

run_test "å…±ç”¨é©—è­‰" "TC-V15-021: å…±ç”¨æ—¥æœŸé©—è­‰" \
    "æ—©é¤80å…ƒï¼Œåˆé¤150å…ƒï¼Œç¾é‡‘" \
    "âœ… æª¢æŸ¥å…©å€‹é …ç›®çš„æ—¥æœŸæ˜¯å¦ç›¸åŒ" \
    "è¨˜å¸³" "2" "ç¾é‡‘" ""

run_test "å…±ç”¨é©—è­‰" "TC-V15-022: å…±ç”¨ä»˜æ¬¾æ–¹å¼é©—è­‰" \
    "å’–å•¡50ï¼Œä¸‰æ˜æ²»35ï¼Œç”¨ç‹—å¡" \
    "âœ… æª¢æŸ¥å…©å€‹é …ç›®çš„ä»˜æ¬¾æ–¹å¼æ˜¯å¦éƒ½æ˜¯å°æ–°ç‹—å¡" \
    "è¨˜å¸³" "2" "å°æ–°ç‹—å¡" ""

# ============================================================
# éŒ¯èª¤è™•ç†èˆ‡é‚Šç•Œæ¡ˆä¾‹
# ============================================================

run_test "éŒ¯èª¤è™•ç†" "TC-V15-030: âŒ ä¸åŒä»˜æ¬¾æ–¹å¼ï¼ˆæ‡‰æ‹’çµ•ï¼‰" \
    "æ—©é¤80å…ƒç¾é‡‘ï¼Œåˆé¤150å…ƒåˆ·å¡" \
    "âŒ æ‡‰å›å‚³éŒ¯èª¤ï¼šåµæ¸¬åˆ°ä¸åŒä»˜æ¬¾æ–¹å¼" \
    "éŒ¯èª¤" "" "" "ä¸åŒä»˜æ¬¾æ–¹å¼"

run_test "éŒ¯èª¤è™•ç†" "TC-V15-031: âŒ ç¬¬äºŒé …ç¼ºå°‘é‡‘é¡ï¼ˆæ‡‰æ‹’çµ•ï¼‰" \
    "æ—©é¤80å…ƒï¼Œåˆé¤ï¼Œç¾é‡‘" \
    "âŒ æ‡‰å›å‚³éŒ¯èª¤ï¼šç¬¬2å€‹é …ç›®ç¼ºå°‘é‡‘é¡" \
    "éŒ¯èª¤" "" "" "ç¼ºå°‘é‡‘é¡"

run_test "å–®é …ç›®è™•ç†" "TC-V15-032: âœ… ã€Œå’Œã€é€£æ¥è©è¦–ç‚ºå–®é …ç›®" \
    "ä¸‰æ˜æ²»å’Œå’–å•¡80å…ƒç¾é‡‘" \
    "âœ… æ‡‰ç‚ºå–®é …ç›®ï¼ˆå¦‚ï¼šæ—©é¤ï¼‰" \
    "è¨˜å¸³" "" "ç¾é‡‘" ""

run_test "éŒ¯èª¤è™•ç†" "TC-V15-033: âŒ ç¼ºå°‘ä»˜æ¬¾æ–¹å¼ï¼ˆæ‡‰æ‹’çµ•ï¼‰" \
    "æ—©é¤80å…ƒï¼Œåˆé¤150å…ƒ" \
    "âŒ æ‡‰å›å‚³éŒ¯èª¤ï¼šç¼ºå°‘ä»˜æ¬¾æ–¹å¼" \
    "éŒ¯èª¤" "" "" "ä»˜æ¬¾æ–¹å¼"

run_test "éŒ¯èª¤è™•ç†" "TC-V15-034: âŒ ç¬¬ä¸€é …ç¼ºå°‘é‡‘é¡ï¼ˆæ‡‰æ‹’çµ•ï¼‰" \
    "æ—©é¤ï¼Œåˆé¤150å…ƒï¼Œç¾é‡‘" \
    "âŒ æ‡‰å›å‚³éŒ¯èª¤ï¼šç¬¬1å€‹é …ç›®ç¼ºå°‘é‡‘é¡" \
    "éŒ¯èª¤" "" "" "ç¼ºå°‘é‡‘é¡"

run_test "éŒ¯èª¤è™•ç†" "TC-V15-035: âŒ ç¼ºå°‘å“é …åç¨±ï¼ˆæ‡‰æ‹’çµ•ï¼‰" \
    "80å…ƒï¼Œ150å…ƒï¼Œç¾é‡‘" \
    "âŒ æ‡‰å›å‚³éŒ¯èª¤ï¼šç¼ºå°‘å“é …åç¨±" \
    "éŒ¯èª¤" "" "" "å“é …"

# ============================================================
# å°è©±æ„åœ–è­˜åˆ¥
# ============================================================

run_test "å°è©±æ„åœ–" "TC-V15-040: æ‰“æ‹›å‘¼" \
    "ä½ å¥½" \
    "âœ… æ„åœ–ï¼šå°è©±" \
    "å°è©±" "" "" ""

run_test "å°è©±æ„åœ–" "TC-V15-041: è©¢å•åŠŸèƒ½" \
    "å¯ä»¥å¹«æˆ‘åšä»€éº¼ï¼Ÿ" \
    "âœ… æ„åœ–ï¼šå°è©±" \
    "å°è©±" "" "" ""

run_test "å°è©±æ„åœ–" "TC-V15-042: æ„Ÿè¬" \
    "è¬è¬" \
    "âœ… æ„åœ–ï¼šå°è©±" \
    "å°è©±" "" "" ""

# ============================================================
# è¤‡é›œå ´æ™¯æ¸¬è©¦
# ============================================================

run_test "è¤‡é›œå ´æ™¯" "TC-V15-050: å«æ˜ç´°èªªæ˜çš„å¤šé …ç›®" \
    "åœ¨é–‹é£¯æ—©é¤50å…ƒï¼Œåœ¨7-11è²·å’–å•¡45å…ƒï¼Œç¾é‡‘" \
    "âœ… 2å€‹é …ç›®ï¼Œå«æ˜ç´°èªªæ˜" \
    "è¨˜å¸³" "2" "ç¾é‡‘" ""

run_test "è¤‡é›œå ´æ™¯" "TC-V15-051: å«ä¸åŒåˆ†é¡çš„å¤šé …ç›®" \
    "å’–å•¡50å…ƒï¼Œè›‹ç³•120å…ƒï¼Œç‹—å¡" \
    "âœ… 2å€‹é …ç›®ï¼Œä¸åŒåˆ†é¡ï¼ˆé£²å“ã€é»å¿ƒï¼‰" \
    "è¨˜å¸³" "2" "å°æ–°ç‹—å¡" ""

# ============================================================
# å®Œæˆ
# ============================================================

echo ""
echo "======================================================================"
echo "âœ… v1.5.0 æ¸¬è©¦å®Œæˆï¼"
echo "======================================================================"
echo ""

if [[ "$AUTO_MODE" == true ]]; then
    # è‡ªå‹•æ¨¡å¼ï¼šé¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
    echo "ğŸ“Š æ¸¬è©¦çµ±è¨ˆï¼š"
    echo "  - ç¸½æ¸¬è©¦æ•¸: $TOTAL_TESTS"
    echo -e "  - ${GREEN}é€šé: $PASSED_TESTS${NC}"
    echo -e "  - ${RED}å¤±æ•—: $FAILED_TESTS${NC}"

    if [[ $SKIPPED_TESTS -gt 0 ]]; then
        echo -e "  - ${YELLOW}è·³é: $SKIPPED_TESTS${NC}"
    fi

    echo ""

    # è¨ˆç®—é€šéç‡
    if [[ $TOTAL_TESTS -gt 0 ]]; then
        pass_rate=$((PASSED_TESTS * 100 / TOTAL_TESTS))
        echo "ğŸ“ˆ é€šéç‡: $pass_rate%"
        echo ""

        if [[ $pass_rate -eq 100 ]]; then
            echo -e "${GREEN}ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼${NC}"
        elif [[ $pass_rate -ge 80 ]]; then
            echo -e "${YELLOW}âš ï¸  å¤§éƒ¨åˆ†æ¸¬è©¦é€šéï¼Œä½†ä»æœ‰å¤±æ•—é …ç›®éœ€è¦ä¿®å¾©${NC}"
        else
            echo -e "${RED}âŒ æ¸¬è©¦å¤±æ•—ç‡éé«˜ï¼Œéœ€è¦æª¢æŸ¥å•é¡Œ${NC}"
        fi
    fi
else
    # äººå·¥æ¨¡å¼ï¼šé¡¯ç¤ºåŸºæœ¬è³‡è¨Š
    echo "æ¸¬è©¦çµ±è¨ˆï¼š"
    echo "  - å‘å¾Œç›¸å®¹ï¼š3 å€‹æ¸¬è©¦"
    echo "  - å¤šé …ç›®æ ¸å¿ƒåŠŸèƒ½ï¼š6 å€‹æ¸¬è©¦"
    echo "  - å…±ç”¨é©—è­‰ï¼š3 å€‹æ¸¬è©¦"
    echo "  - éŒ¯èª¤è™•ç†ï¼š6 å€‹æ¸¬è©¦"
    echo "  - å°è©±æ„åœ–ï¼š3 å€‹æ¸¬è©¦"
    echo "  - è¤‡é›œå ´æ™¯ï¼š2 å€‹æ¸¬è©¦"
    echo "  - ç¸½è¨ˆï¼š23 å€‹æ¸¬è©¦"
    echo ""
    echo "é—œéµé©—è­‰é»ï¼š"
    echo "  âœ… å‘å¾Œç›¸å®¹ï¼šå–®é …ç›®ä½¿ç”¨ v1 æ ¼å¼"
    echo "  âœ… å¤šé …ç›®è™•ç†ï¼š2-4+ é …ç›®æ­£ç¢ºè­˜åˆ¥"
    echo "  âœ… å…±ç”¨é©—è­‰ï¼šäº¤æ˜“IDã€ä»˜æ¬¾æ–¹å¼ã€æ—¥æœŸç›¸åŒ"
    echo "  âŒ éŒ¯èª¤æ‹’çµ•ï¼šä¸åŒä»˜æ¬¾æ–¹å¼ã€ç¼ºå°‘è³‡è¨Šã€æ¨¡ç³Šæƒ…æ³"
fi

echo ""
